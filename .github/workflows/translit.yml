name: DSTU 9112:2021 Transliteration

on:
  push:
    branches:
      - main
    paths:
      - 'translation.csv'
      - 'README.md'
      - 'Translation Files/translation_org.csv'
      - 'Translation Files/translation.csv'
      - 'Steam Workshop Version/Ukrainian_Language/translation.csv'
      - 'Manual Install Version/Ukrainian_Language/translation.csv'

jobs:
  transliterate:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout main branch
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          submodules: recursive

      - name: Setup Rust
        uses: dtolnay/rust-toolchain@stable

      - name: Cache Rust dependencies
        uses: actions/cache@v4
        with:
          path: |
            ~/.cargo/registry
            ~/.cargo/git
            external/UkrainianTransliterator/target
          key: ${{ runner.os }}-cargo-${{ hashFiles('external/UkrainianTransliterator/Cargo.lock') }}
          restore-keys: |
            ${{ runner.os }}-cargo-

      - name: Build dstu9112 transliterator
        run: |
          cd external/UkrainianTransliterator
          cargo build --release
          mkdir -p ../../.github/bin
          cp target/release/ukrainian-transliterator ../../.github/bin/dstu9112
          chmod +x ../../.github/bin/dstu9112

      - name: Checkout or create latyn branch
        run: |
          git config user.name "GitHub Actions Bot"
          git config user.email "actions@github.com"

          MAIN_COMMIT=$(git rev-parse HEAD)
          echo "MAIN_COMMIT=$MAIN_COMMIT" >> $GITHUB_ENV

          if git ls-remote --heads origin latyn | grep -
